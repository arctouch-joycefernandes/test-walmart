{"version":3,"sources":["../src/profile.js"],"names":["getNightwatchConfig","profile","logger","prefix","config","desiredCapabilities","debug","JSON","stringify","getProfiles","opts","argvMock","runArgv","argv","Promise","resolve","browsers","local_browser","push","local_browsers","_","forEach","split","browser","settings","testFramework","profiles","executor","warn","id","getCapabilities","reject","p","e","err","listBrowsers","callback","listedBrowsers","log","join"],"mappings":"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","file":"profile.js","sourcesContent":["import _ from \"lodash\";\nimport { argv } from \"yargs\";\nimport logger from \"testarmada-logger\";\n\nexport default {\n  getNightwatchConfig: (profile) => {\n    logger.prefix = \"Local Executor\";\n\n    const config = {\n      desiredCapabilities: profile.desiredCapabilities\n    };\n\n    logger.debug(`executor config: ${JSON.stringify(config)}`);\n    return config;\n  },\n\n  getProfiles: (opts, argvMock = null) => {\n    logger.prefix = \"Local Executor\";\n\n    let runArgv = argv;\n\n    if (argvMock) {\n      runArgv = argvMock;\n    }\n\n    return new Promise((resolve) => {\n      const browsers = [];\n\n      if (runArgv.local_browser) {\n        browsers.push(runArgv.local_browser);\n      } else if (runArgv.local_browsers) {\n        _.forEach(runArgv.local_browsers.split(\",\"), (browser) => {\n          browsers.push(browser);\n        });\n      }\n\n      if (opts.settings.testFramework.profile\n        && opts.settings.testFramework.profile.getProfiles) {\n        // if framework plugin knows how to solve profiles\n        const profiles = opts.settings.testFramework.profile.getProfiles(browsers);\n\n        _.forEach(profiles, (profile) => {\n          profile.executor = \"local\";\n        });\n\n        logger.debug(`detected profile: ${JSON.stringify(profiles)}`);\n        resolve(profiles);\n      } else {\n        // framework doesn't understand how to solve profiles\n        logger.warn(\"no profile is detected, use the default one\");\n        resolve([{ executor: \"local\", id: \"mocha\" }]);\n      }\n    });\n\n  },\n\n  /*eslint-disable global-require*/\n  getCapabilities: (profile, opts) => {\n    logger.prefix = \"Local Executor\";\n    return new Promise((resolve, reject) => {\n      if (opts.settings.testFramework.profile\n        && opts.settings.testFramework.profile.getCapabilities) {\n        // if framework plugin knows how to solve capabilities\n\n\n        try {\n          const p = opts.settings.testFramework.profile.getCapabilities(profile);\n          p.executor = \"local\";\n\n          resolve(p);\n        } catch (e) {\n          logger.err(`profile: ${profile} isn't found`);\n          reject(e);\n        }\n\n      } else {\n        // framework doesn't understand how to solve capabilities\n        logger.warn(\"no capabilities is detected, use the default one\");\n        resolve({ executor: \"local\", id: \"mocha\" });\n      }\n    });\n  },\n\n  /*eslint-disable global-require*/\n  listBrowsers: (opts, callback) => {\n    logger.prefix = \"Local Executor\";\n\n    if (opts.settings.testFramework.profile\n      && opts.settings.testFramework.profile.listBrowsers) {\n      // if framework plugin knows how to list browsers\n\n      const listedBrowsers = opts.settings.testFramework.profile.listBrowsers();\n      logger.log(`Available browsers: ${listedBrowsers.join(\",\")}`);\n\n      return callback();\n    } else {\n      // if framework plugin doesn't know how to list browsers\n      return callback();\n    }\n  }\n};\n"]}