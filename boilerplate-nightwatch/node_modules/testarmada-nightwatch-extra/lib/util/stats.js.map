{"version":3,"sources":["../../src/util/stats.js"],"names":["event","sdclient","customizedOptions","isEnabled","ISENABLED","host","HOST","port","PORT","prefix","PREFIX","jobName","JOBNAME","fullEventKey","util","format","capabilities","id","browserName","type","cmd","client","SDC","timing","value","totalTime","seleniumCallTime","executeAsyncTime","process","env","MAGELLAN_STATSD","MAGELLANSTATS_STATSD_URL","MAGELLANSTATS_STATSD_PORT","MAGELLANSTATS_STATSD_PREFIX","MAGELLAN_JOB_NAME"],"mappings":";;;;;;kBAWe,UAAUA,KAAV,EAA4D;AAAA,MAA3CC,QAA2C,uEAAhC,IAAgC;AAAA,MAA1BC,iBAA0B,uEAAN,IAAM;;AACzE;;;;;;;;;;;;;;;;;;;;AAoBA,MAAMC,YAAYD,oBAAoBA,kBAAkBC,SAAtC,GAAkDC,SAApE;AACA,MAAMC,OAAOH,oBAAoBA,kBAAkBG,IAAtC,GAA6CC,IAA1D;AACA,MAAMC,OAAOL,oBAAoBA,kBAAkBK,IAAtC,GAA6CC,IAA1D;AACA,MAAMC,SAASP,oBAAoBA,kBAAkBO,MAAtC,GAA+CC,MAA9D;AACA,MAAMC,UAAUT,oBAAoBA,kBAAkBS,OAAtC,GAAgDC,OAAhE;;AAEA,MAAI,CAACT,SAAD,IAAc,CAACE,IAAf,IAAuB,CAACE,IAA5B,EAAkC;AAChC;AACD;;AAED,MAAMM,eAAeC,eAAKC,MAAL,CACnB,kBADmB,EAEnBN,MAFmB,EAGnBT,MAAMgB,YAAN,CAAmBC,EAAnB,IAAyBjB,MAAMgB,YAAN,CAAmBE,WAHzB,EAInBlB,MAAMgB,YAAN,CAAmB,mBAAnB,IAA0C,QAA1C,GAAqD,UAJlC,EAKnBL,OALmB,EAMnBX,MAAMmB,IANa,EAOnBnB,MAAMoB,GAPa,CAArB;;AAUA,MAAMC,SAASpB,WAAWA,QAAX,GAAsB,IAAIqB,sBAAJ,CAAQ,EAAEjB,UAAF,EAAQE,UAAR,EAAcE,cAAd,EAAR,CAArC;;AAEAY,SAAOE,MAAP,CAAiBV,YAAjB,iBAA4Cb,MAAMwB,KAAN,CAAYC,SAAxD;AACAJ,SAAOE,MAAP,CAAiBV,YAAjB,wBAAmDb,MAAMwB,KAAN,CAAYE,gBAA/D;AACAL,SAAOE,MAAP,CAAiBV,YAAjB,wBAAmDb,MAAMwB,KAAN,CAAYG,gBAA/D;AACD,C;;AAzDD;;;;AACA;;;;;;AAEA;AACA,IAAMvB,YAAYwB,QAAQC,GAAR,CAAYC,eAAZ,GAA8B,IAA9B,GAAqC,KAAvD;AACA,IAAMxB,OAAOsB,QAAQC,GAAR,CAAYE,wBAAzB;AACA,IAAMvB,OAAOoB,QAAQC,GAAR,CAAYG,yBAAzB;AACA,IAAMtB,SAAYkB,QAAQC,GAAR,CAAYI,2BAAxB,MAAN;AACA,IAAMrB,UAAUgB,QAAQC,GAAR,CAAYK,iBAA5B;;AAEA","file":"stats.js","sourcesContent":["import util from \"util\";\nimport SDC from \"statsd-client\";\n\n// second check for magellan compatibility\nconst ISENABLED = process.env.MAGELLAN_STATSD ? true : false;\nconst HOST = process.env.MAGELLANSTATS_STATSD_URL;\nconst PORT = process.env.MAGELLANSTATS_STATSD_PORT;\nconst PREFIX = `${process.env.MAGELLANSTATS_STATSD_PREFIX }.`;\nconst JOBNAME = process.env.MAGELLAN_JOB_NAME;\n\n/*eslint complexity: [\"error\", 12]*/\nexport default function (event, sdclient = null, customizedOptions = null) {\n  /**\n   *  event: {\n            \"capabilities\": {\n                id: 'chrome_latest_Windows_10_Desktop',\n                browserName: 'chrome',\n                version: '50',\n                platform: 'Windows 10',\n                'tunnel-identifier': 'some-tunnel-value',\n                name: 'Google'\n            }\n            \"type\"\" \"command\"\n            \"cmd\": \"clickEl\",\n            \"value\": {\n              totalTime: 300,\n              seleniumCallTime: 180,\n              executeAsyncTime: 120\n            }\n        }\n   */\n\n  const isEnabled = customizedOptions ? customizedOptions.isEnabled : ISENABLED;\n  const host = customizedOptions ? customizedOptions.host : HOST;\n  const port = customizedOptions ? customizedOptions.port : PORT;\n  const prefix = customizedOptions ? customizedOptions.prefix : PREFIX;\n  const jobName = customizedOptions ? customizedOptions.jobName : JOBNAME;\n\n  if (!isEnabled || !host || !port) {\n    return;\n  }\n\n  const fullEventKey = util.format(\n    \"%s%s.%s.%s.%s.%s\",\n    prefix,\n    event.capabilities.id || event.capabilities.browserName,\n    event.capabilities[\"tunnel-identifier\"] ? \"tunnel\" : \"notunnel\",\n    jobName,\n    event.type,\n    event.cmd\n  );\n\n  const client = sdclient ? sdclient : new SDC({ host, port, prefix });\n\n  client.timing(`${fullEventKey }.totalTime`, event.value.totalTime);\n  client.timing(`${fullEventKey }.seleniumCallTime`, event.value.seleniumCallTime);\n  client.timing(`${fullEventKey }.executeAsyncTime`, event.value.executeAsyncTime);\n}\n"]}