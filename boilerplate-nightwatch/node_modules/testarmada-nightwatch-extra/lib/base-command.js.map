{"version":3,"sources":["../src/base-command.js"],"names":["MAX_TIMEOUT","settings","COMMAND_MAX_TIMEOUT","WAIT_INTERVAL","SEEN_MAX","JS_SEEN_MAX","Base","nightwatch","customizedSettings","EventEmitter","call","isSync","startTime","time","totalTime","seleniumCallTime","executeAsyncTime","selectorPrefix","selector","successMessage","failureMessage","checkConditions","bind","syncModeBrowserList","client","util","inherits","prototype","decide","self","nightwatchExecute","api","executeAsync","executeSizzlejs","jsInjection","executeSizzlejsAsync","exam","b","v","desiredCapabilities","browser","parseInt","browser_version","toLowerCase","browserName","version","_","forEach","cap","split","length","execute","executeSizzlejsSync","injectedJsCommand","result","isVisible","seenCount","elapsed","Date","getTime","seens","selectorLength","logger","warn","selectorVisibleLength","elapse","do","value","fail","code","FAILURE_REASONS","BUILTIN_SELECTOR_NOT_VISIBLE","BUILTIN_SELECTOR_NOT_FOUND","setTimeout","fn","args","callback","innerArgs","cloneDeep","selectorUtil","depageobjectize","shift","locateStrategy","unshift","push","getSizzlejsSource","JS_WAIT_INTERNAL","verbose","log","JSON","stringify","status","errorStatus","jsDuration","jsStepDuration","isResultReset","isVisibleStrict","sel","clc","yellowBright","resultDisplay","e","inspect","BUILTIN_SELENIUM_ERROR","pass","actual","expected","pactual","pexpected","message","assertion","format","capabilities","options","type","cmd","cb","apply","emit","pcode","$el","command","module","exports"],"mappings":"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","file":"base-command.js","sourcesContent":["import EventEmitter from \"events\";\nimport util from \"util\";\nimport _ from \"lodash\";\nimport clc from \"cli-color\";\nimport safeJsonStringify from \"json-stringify-safe\";\n\nimport settings from \"./settings\";\nimport selectorUtil from \"./util/selector\";\nimport jsInjection from \"./injections/js-injection\";\nimport stats from \"./util/stats\";\nimport logger from \"./util/logger\";\n\n// Wait until we've seen a selector as :visible SEEN_MAX times, with a\n// wait for WAIT_INTERVAL milliseconds between each visibility test.\nconst MAX_TIMEOUT = settings.COMMAND_MAX_TIMEOUT;\nconst WAIT_INTERVAL = settings.WAIT_INTERVAL;\nconst SEEN_MAX = settings.SEEN_MAX;\nconst JS_SEEN_MAX = settings.JS_SEEN_MAX;\n\nconst Base = function (nightwatch = null, customizedSettings = null) {\n  EventEmitter.call(this);\n\n  this.isSync = false;\n  this.startTime = 0;\n  this.time = {\n    totalTime: 0,\n    seleniumCallTime: 0,\n    executeAsyncTime: 0\n  };\n\n  this.selectorPrefix = \"data-magellan-temp-automation-id\";\n  this.selector = null;\n\n  this.successMessage = \"\";\n  this.failureMessage = \"\";\n\n  this.checkConditions = this.checkConditions.bind(this);\n  this.syncModeBrowserList = settings.syncModeBrowserList;\n  // for mock and unit test\n  if (nightwatch) {\n    this.client = nightwatch;\n  }\n\n  if (customizedSettings) {\n    this.syncModeBrowserList = customizedSettings.syncModeBrowserList;\n  }\n};\n\nutil.inherits(Base, EventEmitter);\n\nBase.prototype.decide = function () {\n  const self = this;\n\n  this.nightwatchExecute = this.client.api.executeAsync;\n  this.executeSizzlejs = jsInjection.executeSizzlejsAsync;\n\n  const exam = (b, v, desiredCapabilities) => {\n    if (v) {\n      if (desiredCapabilities.browser\n        && parseInt(desiredCapabilities.browser_version) === parseInt(v)\n        && desiredCapabilities.browser.toLowerCase() === b) {\n        return true;\n      } else if (desiredCapabilities.browserName\n        && parseInt(desiredCapabilities.version) === parseInt(v)\n        && desiredCapabilities.browserName.toLowerCase() === b) {\n        return true;\n      }\n    } else {\n      /* eslint-disable  no-lonely-if */\n      if (desiredCapabilities.browser\n        && desiredCapabilities.browser.toLowerCase() === b) {\n        return true;\n      } else if (desiredCapabilities.browserName\n        && desiredCapabilities.browserName.toLowerCase() === b) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  _.forEach(this.syncModeBrowserList, (browser) => {\n    let b = null;\n    let v = null;\n    const cap = browser.split(\":\");\n    b = cap[0];\n    if (cap.length > 1) {\n      v = cap[1];\n    }\n\n    if (exam(b, v, self.client.desiredCapabilities)) {\n      self.isSync = true;\n      self.nightwatchExecute = self.client.api.execute;\n      self.executeSizzlejs = jsInjection.executeSizzlejsSync;\n    }\n\n  });\n};\n\nBase.prototype.checkConditions = function () {\n  const self = this;\n\n  this.execute(\n    this.executeSizzlejs,\n    [this.selector, this.injectedJsCommand()],\n    (result) => {\n\n      // Keep a running count of how many times we've seen this element visible\n      if (result.isVisible) {\n        self.seenCount += 1;\n      }\n\n      const elapsed = (new Date()).getTime() - self.startTime;\n\n      // If we've seen the selector enough times or waited too long, then\n      // it's time to pass or fail and continue the command chain.\n      if (result.seens >= JS_SEEN_MAX || self.seenCount >= SEEN_MAX || elapsed > MAX_TIMEOUT) {\n\n        // Unlike clickEl, only issue a warning in the getEl() version of this\n        if (result.selectorLength > 1) {\n          logger.warn(`getEl saw selector ${self.selector} but result length was `\n            + `${result.selectorLength}, with ${result.selectorVisibleLength} of those :visible`);\n          logger.warn(`Selector did not disambiguate after ${elapsed} milliseconds,`\n            + \" refine your selector or check DOM for problems.\");\n        }\n\n        if (self.seenCount >= SEEN_MAX || result.seens >= JS_SEEN_MAX) {\n\n          const elapse = (new Date()).getTime();\n          self.time.executeAsyncTime = elapse - self.startTime;\n          self.time.seleniumCallTime = 0;\n\n          self.do(result.value.value);\n        } else if (result.selectorLength > 0) {\n          // element found but not passing the js visibility check\n          self.fail({ code: settings.FAILURE_REASONS.BUILTIN_SELECTOR_NOT_VISIBLE });\n\n        } else {\n          self.fail({ code: settings.FAILURE_REASONS.BUILTIN_SELECTOR_NOT_FOUND });\n        }\n      } else {\n        setTimeout(self.checkConditions, WAIT_INTERVAL);\n      }\n    });\n};\n\nBase.prototype.execute = function (fn, args, callback) {\n  const self = this;\n\n  const innerArgs = _.cloneDeep(args);\n  const selector = selectorUtil.depageobjectize(innerArgs.shift(), this.client.locateStrategy);\n\n  innerArgs.unshift(selector);\n  innerArgs.push(jsInjection.getSizzlejsSource());\n  innerArgs.push(settings.JS_WAIT_INTERNAL);\n  innerArgs.push(settings.JS_SEEN_MAX);\n\n  this.nightwatchExecute(fn, innerArgs, (result) => {\n    if (settings.verbose) {\n      logger.log(`execute(${innerArgs}) intermediate result: ${JSON.stringify(result)}`);\n    }\n    /*eslint no-magic-numbers:0 */\n    if (result && result.status === 0 && result.value !== null) {\n      // Note: by checking the result and passing result.value to the callback,\n      // we are claiming that the result sent to the callback will always be truthy\n      // and useful, relieving the callback from needing to check the structural\n      // validity of result or result.value\n\n      callback.call(self, result.value);\n    } else if (result && result.status === -1\n      && result.errorStatus === 13 && result.value !== null) {\n      // errorStatus = 13: javascript error: document unloaded while waiting for result\n      // we want to reload the page\n      callback.call(self, {\n        seens: 0,\n        jsDuration: 0,\n        jsStepDuration: [],\n        isResultReset: true,\n        isVisibleStrict: null,\n        isVisible: false,\n        selectorVisibleLength: 0,\n        selectorLength: 0,\n        value: {\n          sel: null,\n          value: null\n        }\n      });\n    } else {\n      logger.warn(clc.yellowBright(\"\\u2622  Received error result from Selenium.\"\n        + \" Raw Selenium result object:\"));\n      let resultDisplay;\n      try {\n        resultDisplay = safeJsonStringify(result);\n      } catch (e) {\n        resultDisplay = util.inspect(result, false, null);\n      }\n      logger.warn(clc.yellowBright(resultDisplay));\n      self.fail({ code: settings.FAILURE_REASONS.BUILTIN_SELENIUM_ERROR });\n    }\n  });\n};\n\n/*eslint no-unused-vars:0 */\nBase.prototype.pass = function ({ actual, expected }) {\n  const pactual = actual || \"visible\";\n  const pexpected = pactual;\n  const message = (this.isSync ? \"[sync mode] \" : \"\") + this.successMessage;\n\n  this.time.totalTime = (new Date()).getTime() - this.startTime;\n  this.client.assertion(true, pactual, pexpected, util.format(message, this.time.totalTime), true);\n\n  stats({\n    capabilities: this.client.options.desiredCapabilities,\n    type: \"command\",\n    cmd: this.cmd,\n    value: this.time\n  });\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, [actual]);\n  }\n  this.emit(\"complete\");\n};\n\nBase.prototype.fail = function ({ code, actual, expected }) {\n  // if no code here we do nothing\n  const pcode = code ? code : \"\";\n  const pactual = actual || \"not visible\";\n  const pexpected = expected || \"visible\";\n  const message = `${this.isSync ? \"[sync mode] \" : \"\"}${this.failureMessage} [[${pcode}]]`;\n\n  this.time.totalTime = (new Date()).getTime() - this.startTime;\n  this.client.assertion(false, pactual, pexpected, util.format(message, this.time.totalTime), true);\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, []);\n  }\n  this.emit(\"complete\");\n};\n\n/**\n * All children have to implement injectedJsCommand\n *\n */\n/* istanbul ignore next */\n/*eslint no-unused-vars:0 */\nBase.prototype.injectedJsCommand = function ($el) {\n  return \"\";\n};\n\n\n/**\n * All children have to implement do\n *\n */\n/* istanbul ignore next */\n/*eslint no-unused-vars:0 */\nBase.prototype.do = function (value) {\n\n};\n\n/**\n * All children have to implement command\n *\n */\n/* istanbul ignore next */\n/*eslint no-unused-vars:0 */\nBase.prototype.command = function (selector, cb) {\n  return this;\n};\n\nmodule.exports = Base;\n"]}