{"version":3,"sources":["../../../src/commands/mobile/scrollDownToElement.js"],"names":["MAX_ATTEMPTS","distance","CONDITIONAL_CHECK","ScrollDownToElement","nightwatch","BaseCommand","call","cmd","util","inherits","prototype","command","xStart","yStart","elementLocateStrategy","elementSelector","cb","self","selector","using","scrollToFindElement","attempts","client","api","getMobileElConditional","result","yEnd","xEnd","_","toLower","capabilities","platformName","Math","abs","failWithMessage","swipeScreenTo","passWithMessage","passMessage","pactual","pexpected","assertion","format","apply","emit","failMessage","module","exports"],"mappings":"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","file":"scrollDownToElement.js","sourcesContent":["import util from \"util\";\nimport BaseCommand from \"../../base-mobile-command\";\nimport _ from \"lodash\";\n\nconst MAX_ATTEMPTS = 10;\nconst distance = 200;\nconst CONDITIONAL_CHECK = 1000;\n\nconst ScrollDownToElement = function (nightwatch = null) {\n  BaseCommand.call(this, nightwatch);\n  this.cmd = \"scrolldowntoelement\";\n};\n\nutil.inherits(ScrollDownToElement, BaseCommand);\n\n/* eslint-disable  max-params */\nScrollDownToElement.prototype.command =\n  function (xStart, yStart, elementLocateStrategy, elementSelector, cb) {\n    const self = this;\n    this.selector = elementSelector;\n    this.using = elementLocateStrategy;\n    this.cb = cb;\n\n    const scrollToFindElement = function (attempts) {\n      if (attempts < MAX_ATTEMPTS) {\n        self.client.api.getMobileElConditional(\n          elementLocateStrategy,\n          elementSelector,\n          CONDITIONAL_CHECK,\n          (result) => {\n            if (!result) {\n              let yEnd = yStart > distance ? yStart - distance : 1;\n              let xEnd = xStart;\n              if (_.toLower(self.client.api.capabilities.platformName) === \"android\") {\n                // do nothing here\n              } else if (_.toLower(self.client.api.capabilities.platformName) === \"ios\") {\n                yEnd = -Math.abs(distance);\n                xEnd = 0;\n              } else {\n                self.failWithMessage(`Invalid platform ${self.client.api.capabilities.platformName}`\n                  + `, expected ios or android`);\n              }\n\n              self.client.api.swipeScreenTo(xStart, yStart, xEnd, yEnd, () => {\n                scrollToFindElement(attempts + 1);\n              });\n            } else {\n              self.passWithMessage(`Selector '${self.using}:${self.selector}' `\n                + `was visible after scrolling`);\n            }\n          });\n\n      } else {\n        self.failWithMessage(`Selector '${self.using}:${self.selector}' `\n          + `was not visible after scrolling ${MAX_ATTEMPTS} times`);\n      }\n    };\n\n    scrollToFindElement(0);\n  };\n\nScrollDownToElement.prototype.passWithMessage = function (passMessage) {\n  const pactual = \"visible\";\n  const pexpected = pactual;\n\n  this.client.assertion(true, pactual, pexpected, util.format(passMessage), true);\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, []);\n  }\n  this.emit(\"complete\");\n};\n\nScrollDownToElement.prototype.failWithMessage = function (failMessage) {\n  const pactual = \"not visible\";\n  const pexpected = \"visible\";\n\n  this.client.assertion(false, pactual, pexpected, util.format(failMessage), true);\n\n  if (this.cb) {\n    this.cb.apply(this.client.api, []);\n  }\n  this.emit(\"complete\");\n};\n\nmodule.exports = ScrollDownToElement;\n"]}