{"version":3,"sources":["../../../src/commands/mobile/waitForMobileElNotPresent.js"],"names":["MAX_TIMEOUT","settings","COMMAND_MAX_TIMEOUT","WAIT_INTERVAL","SEEN_MAX","WaitForMobileElNotPresent","nightwatch","BaseCommand","call","cmd","util","inherits","prototype","do","checkConditions","self","options","path","client","sessionId","method","data","using","value","selector","protocol","result","status","errorStatus","seenCount","elapsed","Date","getTime","startTime","elapse","time","executeAsyncTime","seleniumCallTime","pass","actual","expected","fail","code","FAILURE_REASONS","BUILTIN_SELECTOR_NOT_VISIBLE","message","failureMessage","setTimeout","command","successMessage","format","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,cAAcC,mBAASC,mBAA7B;AACA,IAAMC,gBAAgBF,mBAASE,aAA/B;AACA,IAAMC,WAAWH,mBAASG,QAA1B;;AAEA,IAAMC,4BAA4B,SAA5BA,yBAA4B,GAA6B;AAAA,MAAnBC,UAAmB,uEAAN,IAAM;;AAC7DC,8BAAYC,IAAZ,CAAiB,IAAjB,EAAuBF,UAAvB;AACA,OAAKG,GAAL,GAAW,2BAAX;AACD,CAHD;;AAKAC,eAAKC,QAAL,CAAcN,yBAAd,EAAyCE,2BAAzC;;AAEAF,0BAA0BO,SAA1B,CAAoCC,EAApC,GAAyC,YAAY,CAAG,CAAxD;;AAEAR,0BAA0BO,SAA1B,CAAoCE,eAApC,GAAsD,YAAY;AAChE,MAAMC,OAAO,IAAb;;AAEA,MAAMC,UAAU;AACdC,wBAAkB,KAAKC,MAAL,CAAYC,SAA9B,aADc;AAEdC,YAAQ,MAFM;AAGdC,UAAM;AACJC,aAAO,KAAKA,KADR;AAEJC,aAAO,KAAKC;AAFR;AAHQ,GAAhB;;AASAT,OAAKU,QAAL,CAAcT,OAAd,EAAuB,UAACU,MAAD,EAAY;AACjC;AACA,QAAIA,OAAOC,MAAP,KAAkB,CAAC,CAAnB,IACCD,OAAOE,WAAP,KAAuB,CAD5B,EAC+B;AAC7B;AACAb,WAAKc,SAAL,IAAkB,CAAlB;AACD;;AAED,QAAMC,UAAW,IAAIC,IAAJ,EAAD,CAAaC,OAAb,KAAyBjB,KAAKkB,SAA9C;;AAEA,QAAIlB,KAAKc,SAAL,IAAkBzB,QAAlB,IAA8B0B,UAAU9B,WAA5C,EAAyD;AACvD,UAAIe,KAAKc,SAAL,IAAkBzB,QAAtB,EAAgC;AAC9B,YAAM8B,SAAU,IAAIH,IAAJ,EAAD,CAAaC,OAAb,EAAf;AACAjB,aAAKoB,IAAL,CAAUC,gBAAV,GAA6BF,SAASnB,KAAKkB,SAA3C;AACAlB,aAAKoB,IAAL,CAAUE,gBAAV,GAA6B,CAA7B;;AAEAtB,aAAKuB,IAAL,CAAU;AACRC,kBAAQ,aADA;AAERC,oBAAU;AAFF,SAAV;AAID,OATD,MASO;AACLzB,aAAK0B,IAAL,CAAU;AACRC,gBAAMzC,mBAAS0C,eAAT,CAAyBC,4BADvB;AAERL,kBAAQ,SAFA;AAGRC,oBAAU,aAHF;AAIRK,mBAAS9B,KAAK+B;AAJN,SAAV;AAMD;AACF,KAlBD,MAkBO;AACLC,iBAAWhC,KAAKD,eAAhB,EAAiCX,aAAjC;AACD;AACF,GA/BD;AAgCD,CA5CD;;AA8CA;AACAE,0BAA0BO,SAA1B,CAAoCoC,OAApC,GAA8C,UAAU1B,KAAV,EAAiBE,QAAjB,EAA2B;AACvE,OAAKA,QAAL,GAAgBA,QAAhB;AACA,OAAKF,KAAL,GAAaA,KAAb;;AAEA,OAAK2B,cAAL,GAAsBvC,eAAKwC,MAAL,CAAY,+CAC9B,wBADkB,EACQ,KAAK5B,KADb,EACoB,KAAKE,QADzB,CAAtB;AAEA,OAAKsB,cAAL,GAAsBpC,eAAKwC,MAAL,CAAY,0CAC9B,wBADkB,EACQ,KAAK5B,KADb,EACoB,KAAKE,QADzB,CAAtB;;AAGA,OAAKS,SAAL,GAAkB,IAAIF,IAAJ,EAAD,CAAaC,OAAb,EAAjB;;AAEA;AACA,OAAKH,SAAL,GAAiB,CAAjB;AACA,OAAKf,eAAL;;AAEA,SAAO,IAAP;AACD,CAhBD;;AAkBAqC,OAAOC,OAAP,GAAiB/C,yBAAjB","file":"waitForMobileElNotPresent.js","sourcesContent":["import util from \"util\";\nimport BaseCommand from \"../../base-mobile-command\";\nimport settings from \"../../settings\";\n\nconst MAX_TIMEOUT = settings.COMMAND_MAX_TIMEOUT;\nconst WAIT_INTERVAL = settings.WAIT_INTERVAL;\nconst SEEN_MAX = settings.SEEN_MAX;\n\nconst WaitForMobileElNotPresent = function (nightwatch = null) {\n  BaseCommand.call(this, nightwatch);\n  this.cmd = \"waitformobileelnotpresent\";\n};\n\nutil.inherits(WaitForMobileElNotPresent, BaseCommand);\n\nWaitForMobileElNotPresent.prototype.do = function () { };\n\nWaitForMobileElNotPresent.prototype.checkConditions = function () {\n  const self = this;\n\n  const options = {\n    path: `/session/${this.client.sessionId}/element`,\n    method: \"POST\",\n    data: {\n      using: this.using,\n      value: this.selector\n    }\n  };\n\n  self.protocol(options, (result) => {\n    /*eslint-disable no-magic-numbers*/\n    if (result.status === -1\n      && result.errorStatus === 7) {\n      // element isn't found\n      self.seenCount += 1;\n    }\n\n    const elapsed = (new Date()).getTime() - self.startTime;\n\n    if (self.seenCount >= SEEN_MAX || elapsed > MAX_TIMEOUT) {\n      if (self.seenCount >= SEEN_MAX) {\n        const elapse = (new Date()).getTime();\n        self.time.executeAsyncTime = elapse - self.startTime;\n        self.time.seleniumCallTime = 0;\n\n        self.pass({\n          actual: \"not visible\",\n          expected: \"not visible\"\n        });\n      } else {\n        self.fail({\n          code: settings.FAILURE_REASONS.BUILTIN_SELECTOR_NOT_VISIBLE,\n          actual: \"visible\",\n          expected: \"not visible\",\n          message: self.failureMessage\n        });\n      }\n    } else {\n      setTimeout(self.checkConditions, WAIT_INTERVAL);\n    }\n  });\n};\n\n/*eslint max-params:[\"error\", 4] */\nWaitForMobileElNotPresent.prototype.command = function (using, selector) {\n  this.selector = selector;\n  this.using = using;\n\n  this.successMessage = util.format(\"Selector <%s:%s> successfully disappeared \"\n    + \"after %d milliseconds \", this.using, this.selector);\n  this.failureMessage = util.format(\"Selector <%s:%s> failed to disappear \"\n    + \"after %d milliseconds \", this.using, this.selector);\n\n  this.startTime = (new Date()).getTime();\n\n  // Track how many times we've seen selector as :visible\n  this.seenCount = 0;\n  this.checkConditions();\n\n  return this;\n};\n\nmodule.exports = WaitForMobileElNotPresent;\n"]}