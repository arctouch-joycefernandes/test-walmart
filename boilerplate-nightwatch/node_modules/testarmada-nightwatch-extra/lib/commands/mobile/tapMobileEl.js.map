{"version":3,"sources":["../../../src/commands/mobile/tapMobileEl.js"],"names":["MAX_TIMEOUT","settings","COMMAND_MAX_TIMEOUT","WAIT_INTERVAL","TouchMobileEl","nightwatch","BaseCommand","call","cmd","util","inherits","prototype","do","value","pass","actual","checkConditions","self","options","path","client","sessionId","method","data","x","y","protocol","result","status","seenCount","elapsed","Date","getTime","startTime","elapse","time","executeAsyncTime","seleniumCallTime","fail","code","FAILURE_REASONS","BUILTIN_ELEMENT_NOT_OPERABLE","message","failureMessage","setTimeout","command","cb","successMessage","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,cAAcC,mBAASC,mBAA7B;AACA,IAAMC,gBAAgBF,mBAASE,aAA/B;;AAEA,IAAMC,gBAAgB,SAAhBA,aAAgB,GAA6B;AAAA,MAAnBC,UAAmB,uEAAN,IAAM;;AACjDC,8BAAYC,IAAZ,CAAiB,IAAjB,EAAuBF,UAAvB;AACA,OAAKG,GAAL,GAAW,aAAX;AACD,CAHD;;AAKAC,eAAKC,QAAL,CAAcN,aAAd,EAA6BE,2BAA7B;;AAEAF,cAAcO,SAAd,CAAwBC,EAAxB,GAA6B,UAAUC,KAAV,EAAiB;AAC5C,OAAKC,IAAL,CAAU,EAAEC,QAAQF,KAAV,EAAV;AACD,CAFD;;AAIAT,cAAcO,SAAd,CAAwBK,eAAxB,GAA0C,YAAY;AACpD,MAAMC,OAAO,IAAb;;AAEA,MAAMC,UAAU;AACdC,wBAAkB,KAAKC,MAAL,CAAYC,SAA9B,mBADc;AAEdC,YAAQ,MAFM;AAGdC,UAAM;AACJ,iBAAW,CACT,EAAE,UAAU,OAAZ,EAAqB,WAAW,EAAE,KAAK,KAAKC,CAAZ,EAAe,KAAK,KAAKC,CAAzB,EAAhC,EADS,EAET,EAAE,UAAU,MAAZ,EAAoB,WAAW,EAAE,MAAM,GAAR,EAA/B,EAFS,EAGT,EAAE,UAAU,SAAZ,EAAuB,WAAW,EAAlC,EAHS;AADP;AAHQ,GAAhB;;AAWAR,OAAKS,QAAL,CAAcR,OAAd,EAAuB,UAACS,MAAD,EAAY;AACjC,QAAIA,OAAOC,MAAP,KAAkB,CAAtB,EAAyB;AACvB;AACAX,WAAKY,SAAL,IAAkB,CAAlB;AACD;;AAED,QAAMC,UAAW,IAAIC,IAAJ,EAAD,CAAaC,OAAb,KAAyBf,KAAKgB,SAA9C;AACA,QAAIhB,KAAKY,SAAL,IAAkB,CAAlB,IAAuBC,UAAU9B,WAArC,EAAkD;AAChD,UAAIiB,KAAKY,SAAL,IAAkB,CAAtB,EAAyB;AACvB,YAAMK,SAAU,IAAIH,IAAJ,EAAD,CAAaC,OAAb,EAAf;AACAf,aAAKkB,IAAL,CAAUC,gBAAV,GAA6BF,SAASjB,KAAKgB,SAA3C;AACAhB,aAAKkB,IAAL,CAAUE,gBAAV,GAA6B,CAA7B;AACApB,aAAKL,EAAL,CAAQe,OAAOd,KAAf;AACD,OALD,MAKO;AACLI,aAAKqB,IAAL,CAAU;AACRC,gBAAMtC,mBAASuC,eAAT,CAAyBC,4BADvB;AAERC,mBAASzB,KAAK0B;AAFN,SAAV;AAID;AACF,KAZD,MAYO;AACLC,iBAAW3B,KAAKD,eAAhB,EAAiCb,aAAjC;AACD;AACF,GAtBD;AAuBD,CArCD;;AAuCA;AACAC,cAAcO,SAAd,CAAwBkC,OAAxB,GAAkC,UAAUrB,CAAV,EAAaC,CAAb,EAAgBqB,EAAhB,EAAoB;AACpD,OAAKA,EAAL,GAAUA,EAAV;AACA,OAAKtB,CAAL,GAASA,CAAT;AACA,OAAKC,CAAL,GAASA,CAAT;;AAEA,OAAKsB,cAAL,iBAAkCvB,CAAlC,YAA0CC,CAA1C;AACA,OAAKkB,cAAL,iBAAkCnB,CAAlC,YAA0CC,CAA1C;;AAEA,OAAKQ,SAAL,GAAkB,IAAIF,IAAJ,EAAD,CAAaC,OAAb,EAAjB;;AAEA;AACA,OAAKH,SAAL,GAAiB,CAAjB;AACA,OAAKb,eAAL;;AAEA,SAAO,IAAP;AACD,CAfD;;AAiBAgC,OAAOC,OAAP,GAAiB7C,aAAjB","file":"tapMobileEl.js","sourcesContent":["import util from \"util\";\nimport BaseCommand from \"../../base-mobile-command\";\nimport settings from \"../../settings\";\n\nconst MAX_TIMEOUT = settings.COMMAND_MAX_TIMEOUT;\nconst WAIT_INTERVAL = settings.WAIT_INTERVAL;\n\nconst TouchMobileEl = function (nightwatch = null) {\n  BaseCommand.call(this, nightwatch);\n  this.cmd = \"tapmobileel\";\n};\n\nutil.inherits(TouchMobileEl, BaseCommand);\n\nTouchMobileEl.prototype.do = function (value) {\n  this.pass({ actual: value });\n};\n\nTouchMobileEl.prototype.checkConditions = function () {\n  const self = this;\n\n  const options = {\n    path: `/session/${this.client.sessionId}/touch/perform`,\n    method: \"POST\",\n    data: {\n      \"actions\": [\n        { \"action\": \"press\", \"options\": { \"x\": this.x, \"y\": this.y } },\n        { \"action\": \"wait\", \"options\": { \"ms\": 800 } },\n        { \"action\": \"release\", \"options\": {} }]\n    }\n  };\n\n  self.protocol(options, (result) => {\n    if (result.status === 0) {\n      // sucessful\n      self.seenCount += 1;\n    }\n\n    const elapsed = (new Date()).getTime() - self.startTime;\n    if (self.seenCount >= 1 || elapsed > MAX_TIMEOUT) {\n      if (self.seenCount >= 1) {\n        const elapse = (new Date()).getTime();\n        self.time.executeAsyncTime = elapse - self.startTime;\n        self.time.seleniumCallTime = 0;\n        self.do(result.value);\n      } else {\n        self.fail({\n          code: settings.FAILURE_REASONS.BUILTIN_ELEMENT_NOT_OPERABLE,\n          message: self.failureMessage\n        });\n      }\n    } else {\n      setTimeout(self.checkConditions, WAIT_INTERVAL);\n    }\n  });\n};\n\n/*eslint max-params:[\"error\", 5] */\nTouchMobileEl.prototype.command = function (x, y, cb) {\n  this.cb = cb;\n  this.x = x;\n  this.y = y;\n\n  this.successMessage = `Point {x:${x}, y:${y}} was tapped after %d milliseconds.`;\n  this.failureMessage = `Point {x:${x}, y:${y}} wasn't tapped after %d milliseconds.`;\n\n  this.startTime = (new Date()).getTime();\n\n  // Track how many times selector is successfully checked by /element protocol\n  this.seenCount = 0;\n  this.checkConditions();\n\n  return this;\n};\n\nmodule.exports = TouchMobileEl;\n"]}